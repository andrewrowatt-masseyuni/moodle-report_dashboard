{"version":3,"file":"dashboard.min.js","sources":["../src/dashboard.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module dashboard\n *\n * @module     report_dashboard/dashboard\n * @copyright  2025 Andrew Rowatt <A.J.Rowatt@massey.ac.nz>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport DataTable from 'report_dashboard/dataTables';\nimport 'report_dashboard/dataTables.bootstrap4';\nimport 'report_dashboard/dataTables.select';\nimport 'report_dashboard/dataTables.buttons';\nimport 'report_dashboard/buttons.bootstrap4';\nimport 'report_dashboard/buttons.html5';\nimport {setUserPreference} from 'core_user/repository';\nimport Chartjs from 'core/chartjs';\n\nexport const init = () => {\n    $(function() {\n        window.console.log('Report dashboard initialising'); // Debug log to confirm script is running\n        var table = new DataTable('#report_dashboard_dashboard',\n            {\n                orderCellsTop: true,\n                responsive: false,\n                autoWidth: false,\n                paging: false,\n                layout: {\n                    topStart: 'info',\n                    topEnd: null,\n                    bottomStart: {\n                        buttons: [\n                            {\n                                extend: 'excelHtml5',\n                                text: 'Export to Excel',\n                            },\n                            {\n                                text: 'Copy email addresses of selected students',\n                                className: 'customButton customButtonCopyEmailAddress btn btn-secondary',\n                                action: function(e, dt) {\n                                    let s = '';\n                                    // eslint-disable-next-line array-callback-return, no-unused-vars\n                                    dt.rows({selected: true}).every((rowIdx, tableLoop, rowLoop) => {\n                                        const node = this.cell(rowIdx, 2).node();\n                                        s += node.dataset.formattedEmail + ';';\n                                    });\n\n                                    navigator.clipboard.writeText(s);\n                                }\n                            },\n                            {\n                                text: 'Create email to selected students...',\n                                className: 'customButton customButtonCreateEmail btn btn-secondary',\n                                action: function(e, dt) {\n                                    var s = '';\n                                    // eslint-disable-next-line array-callback-return, no-unused-vars\n                                    dt.rows({selected: true}).every((rowIdx, tableLoop, rowLoop) => {\n                                        const node = this.cell(rowIdx, 2).node();\n                                        s += node.dataset.formattedEmail + ';';\n                                    });\n                                    location.href = `mailto:?bcc=${encodeURIComponent(s)}`;\n                                }\n                            },\n                            {\n                                text: 'Clear selected rows',\n                                className: 'customButton customButtonClearSelectedRows btn btn-secondary',\n                                action: function(e, dt) {\n                                    dt.rows({selected: true}).deselect();\n                                }\n                            }\n                        ]\n                    }\n                },\n                columnDefs: [\n                    {\n                        orderable: false,\n                        render: DataTable.render.select(),\n                        targets: 0\n                    }\n                ],\n                select: {\n                    style: 'multi',\n                    headerCheckbox: 'select-page'\n                },\n                order: [[1, 'asc']], /* Removes order symbol from column 0 (checkbox) */\n                initComplete: function() {\n                    // Make any adjustments to the columns when the table is initialised.\n                    this.api().columns([2]).visible(false); // Hide email column\n\n                    // Reveal the table and hide the skeleton loader.\n                    document.querySelector('.dashboard_container').classList.add('dt-ready');\n                }\n            }\n        );\n\n        document.getElementById('report_dashboard_fontsize').addEventListener('change', function() {\n            const dashboardTable = document.getElementById('report_dashboard_dashboard');\n            dashboardTable.className = dashboardTable.className.replace(/\\bsz-\\d+\\b/, 'sz-' + this.value);\n            setUserPreference('report_dashboard_fontsize', this.value);\n        });\n\n        updateFilterCounts(true);\n\n        table.on('draw', function() {\n            updateFilterCounts(false);\n        });\n\n        /* eslint complexity: [\"error\", {\"max\": 30 }] */\n        $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {\n            let row = $(table.row(dataIndex).node());\n\n            /*\n                Last access filter\n            */\n            let lastaccessed = document.querySelector(\"input[name='lastaccessed']:checked\");\n            document.querySelector(\"#lastaccessed > button > span\").textContent = lastaccessed.dataset.label;\n\n            if (lastaccessed.value != \"all\") {\n                if (row.find(`td.tc_lastaccessed span[data-filter-category=\"${lastaccessed.value}\"]`).length == 0) {\n                    return false;\n                }\n            }\n\n            /*\n                Groups filter\n            */\n            let groupmatch = false; // By default we assume that no groups are matching\n            let groups = document.querySelectorAll(\"input[name='groups']\");\n            let groupschecked = document.querySelectorAll(\"input[name='groups']:checked\").length;\n            let anygroupunchecked = groups.length != groupschecked;\n\n            let dropdownlabel = \"Unknown\"; // Default label for the dropdown\n\n            for (const group of groups) {\n                if (group.checked) {\n                    dropdownlabel = group.dataset.label;\n\n                    if (row.find(`td.tc_groups span[data-filter-category=\"${group.value}\"]`).length > 0) {\n                        groupmatch = true;\n                        break;\n                    }\n                }\n            }\n\n            document.getElementById(\"group_select_all\").disabled = !anygroupunchecked;\n            document.getElementById(\"group_select_none\").disabled = groupschecked == 0;\n\n\n            if (groupschecked == 0) {\n                dropdownlabel = \"None\";\n            } else if (groupschecked == 1) {\n                // The dropdownlabel will be set by code above.\n            } else if (anygroupunchecked) {\n                dropdownlabel = \"Multiple Groups\";\n            } else {\n                dropdownlabel = \"All\";\n            }\n\n            document.querySelector(\"#group > button > span\").textContent = dropdownlabel;\n\n            if (!groupmatch) {\n                return false;\n            }\n\n            /*\n                Late assessments filter\n            */\n            let lateassessments = document.querySelector(\"input[name='lateassessments']:checked\");\n            document.querySelector(\"#lateassessments > button > span\").textContent = lateassessments.dataset.label;\n\n            if (lateassessments.value != \"all\") {\n                if (row.find(`td.tc_lateassessments span[data-filter-category=\"${lateassessments.value}\"]`).length == 0) {\n                    return false;\n                }\n            }\n\n            /*\n                Early engagements filter\n            */\n\n            let earlyengagementFilters = document.querySelectorAll(\".earlyengagement_filter\");\n\n            for (const earlyengagementFilter of earlyengagementFilters) {\n                let id = earlyengagementFilter.dataset.earlyengagementid;\n                let itemMatch = false;\n                let items = document.querySelectorAll(`input[name='earlyengagement${id}_filter']`);\n                let itemsChecked = document.querySelectorAll(`input[name='earlyengagement${id}_filter']:checked`).length;\n                let anyUnchecked = items.length != itemsChecked;\n\n                let dropdownlabel = \"Unknown\"; // Default label for the dropdown\n\n                for (const item of items) {\n                    if (item.checked) {\n                        dropdownlabel = item.dataset.label;\n\n                        // eslint-disable-next-line max-len\n                        if (row.find(`td.tc_earlyengagement.earlyengagement${id} span[data-filter-category=\"${item.value}\"]`).length > 0) {\n                            itemMatch = true;\n                            break;\n                        }\n                    }\n                }\n\n                document.getElementById(`earlyengagement${id}_select_all`).disabled = !anyUnchecked;\n                document.getElementById(`earlyengagement${id}_select_none`).disabled = itemsChecked == 0;\n\n                if (itemsChecked == 0) {\n                    dropdownlabel = \"None\";\n                } else if (itemsChecked == 1) {\n                    // The dropdownlabel will be set by code above.\n                } else if (anyUnchecked) {\n                    dropdownlabel = \"Multiple criteria\";\n                } else {\n                    dropdownlabel = \"All\";\n                }\n\n                document.querySelector(`#earlyengagement${id} > button > span`).textContent = dropdownlabel;\n\n                if (!itemMatch) {\n                    return false;\n                }\n            }\n\n            /*\n                Assessments filter\n            */\n\n            let assessmentFilters = document.querySelectorAll(\".assessment_filter\");\n\n            for (const assessmentFilter of assessmentFilters) {\n                let id = assessmentFilter.dataset.assessmentid;\n                let itemMatch = false;\n                let items = document.querySelectorAll(`label:not([data-filter-total=\"0\"]) > input[name='assessment${id}_filter']`);\n                // eslint-disable-next-line max-len\n                let itemsChecked = document.querySelectorAll(`label:not([data-filter-total=\"0\"]) > input[name='assessment${id}_filter']:checked`).length;\n                let anyUnchecked = items.length != itemsChecked;\n\n                let dropdownlabel = \"Unknown\"; // Default label for the dropdown\n\n                for (const item of items) {\n                    if (item.checked) {\n                        dropdownlabel = item.dataset.label;\n\n                        if (row.find(`td.tc_assessment.assessment${id} span[data-filter-category=\"${item.value}\"]`).length > 0) {\n                            itemMatch = true;\n                            break;\n                        }\n                    }\n                }\n\n                document.getElementById(`assessment${id}_select_all`).disabled = !anyUnchecked;\n                document.getElementById(`assessment${id}_select_none`).disabled = itemsChecked == 0;\n\n                if (itemsChecked == 0) {\n                    dropdownlabel = \"None\";\n                } else if (itemsChecked == 1) {\n                    // The dropdownlabel will be set by code above.\n                } else if (anyUnchecked) {\n                    dropdownlabel = \"Multiple criteria\";\n                } else {\n                    dropdownlabel = \"All\";\n                }\n\n                document.querySelector(`#assessment${id} > button > span`).textContent = dropdownlabel;\n\n                if (!itemMatch) {\n                    return false;\n                }\n            }\n\n            return true;\n        });\n\n        $(\"#name_filter\").on(\"input\", function() {\n            // ... Modern search approach\n            table.columns(1).search(this.value).draw();\n        });\n\n        $(\"tr.filters .earlyengagement_filter .dropdown-menu\").on(\"click\", (e) => {\n            let id = e.currentTarget.dataset.earlyengagementid;\n\n            switch (e.target.id) {\n                case `earlyengagement${id}_select_all`:\n                    document.querySelectorAll(`input[name='earlyengagement${id}_filter']`).forEach((item) => {\n                        if (!item.disabled) {\n                            item.checked = true;\n                        }\n                    });\n                    break;\n                case `earlyengagement${id}_select_none`:\n                    document.querySelectorAll(`input[name='earlyengagement${id}_filter']`).forEach((item) => {\n                        item.checked = false;\n                    });\n                    break;\n            }\n        });\n\n        $(\"tr.filters .assessment_filter .dropdown-menu\").on(\"click\", (e) => {\n            let id = e.currentTarget.dataset.assessmentid;\n\n            switch (e.target.id) {\n                case `assessment${id}_select_all`:\n                    document.querySelectorAll(`input[name='assessment${id}_filter']`).forEach((item) => {\n                        if (!item.disabled) {\n                            item.checked = true;\n                        }\n                    });\n                    break;\n                case `assessment${id}_select_none`:\n                    document.querySelectorAll(`input[name='assessment${id}_filter']`).forEach((item) => {\n                        item.checked = false;\n                    });\n                    break;\n            }\n        });\n\n        $(\"tr.filters .dropdown-menu\").on(\"click\", (e) => {\n            /*\n                Special handling cases for filters\n            */\n\n            switch (e.target.id) {\n                case \"group_select_all\":\n                    document.querySelectorAll(\"input[name='groups']\").forEach((group) => {\n                        if (!group.disabled) {\n                            group.checked = true;\n                        }\n                    });\n\n                    break;\n                case \"group_select_none\":\n                    document.querySelectorAll(\"input[name='groups']\").forEach((group) => {\n                        group.checked = false;\n                    });\n                    break;\n            }\n\n            table.draw();\n        });\n\n        /**\n         * Update counts for filters\n         *\n         * @param {boolean} firstTime\n         */\n        function updateFilterCounts(firstTime) {\n            $('[data-filter-count] > input').each(function(i, e) {\n                let filter = e.value;\n                let scope = e.name.replace(\"_filter\", \"\");\n\n                let count = $(`td.${scope} [data-filter-category=\"${filter}\"]`).length;\n                e.parentElement.dataset.filterCount = count;\n                if (firstTime) {\n                    e.parentElement.dataset.filterTotal = count;\n                    e.disabled = !count;\n                    if (!count) {\n                        e.checked = false;\n                    }\n                    e.parentElement.classList.toggle(\"text-muted\", !count);\n                }\n            });\n            updateVisibleCharts();\n        }\n\n        // Chart size constant (px).\n        const CHART_SIZE = 200;\n\n        // Ordered list of facet rings (inner to outer).\n        const FACET_ORDER = ['engagement', 'submission', 'extension'];\n\n        // Colors matching the CSS filter-category colours.\n        const CATEGORY_COLORS = {\n            notdue: '#e0e0e0',\n            submitted: '#c5e0b4',\n            completed: '#c5e0b4',\n            overdue: '#fbe4d5',\n            passed: '#c5e0b4',\n            failed: '#fbe4d5',\n            extension: '#d9edf7',\n            notcompleted: '#d9edf7',\n            viewed: '#c5e0b4',\n            notviewed: '#bdd7ee',\n            none: '#f5f5f5',\n        };\n\n        // Store Chart.js instances so we can destroy before re-rendering.\n        const chartInstances = {};\n\n        /**\n         * Render a multi-ring doughnut chart inside the given container.\n         * Rings are built from data-facet attributes on the table cells.\n         *\n         * @param {string} containerId\n         */\n        function renderChart(containerId) {\n            const container = document.getElementById(containerId);\n            if (!container || container.style.display === 'none') {\n                return;\n            }\n\n            // Derive the column class from the container id, e.g. \"chart_assessment5\" -> \"assessment5\".\n            const scope = containerId.replace('chart_', '');\n\n            // Only count rows that pass ALL current filters (groups, last accessed, etc.).\n            const visibleRows = table.rows({search: 'applied'}).nodes().toArray();\n            if (visibleRows.length === 0) {\n                return;\n            }\n\n            // Count occurrences grouped by facet then by filter-category.\n            const facetCounts = {};\n            FACET_ORDER.forEach(function(f) {\n                facetCounts[f] = {};\n            });\n\n            var cellCount = 0;\n            visibleRows.forEach(function(row) {\n                const cell = row.querySelector('td.' + scope);\n                if (!cell) {\n                    return;\n                }\n                cellCount++;\n                cell.querySelectorAll('[data-facet]').forEach(function(span) {\n                    const facet = span.dataset.facet;\n                    const category = span.dataset.filterCategory;\n                    if (facet && category && facetCounts[facet] !== undefined) {\n                        facetCounts[facet][category] = (facetCounts[facet][category] || 0) + 1;\n                    }\n                });\n            });\n\n            // For the extension ring, add a \"none\" complement so the ring is meaningful.\n            if (facetCounts.extension && Object.keys(facetCounts.extension).length > 0) {\n                const extCount = facetCounts.extension.extension || 0;\n                facetCounts.extension.none = cellCount - extCount;\n            }\n\n            // Build one dataset per facet that has data.\n            const datasets = [];\n            FACET_ORDER.forEach(function(facet) {\n                const counts = facetCounts[facet];\n                const categories = Object.keys(counts);\n                if (categories.length === 0) {\n                    return;\n                }\n                var values = categories.map(function(c) {\n                    return counts[c];\n                });\n                var total = values.reduce(function(a, b) {\n                    return a + b;\n                }, 0);\n                datasets.push({\n                    data: values,\n                    backgroundColor: categories.map(function(c) {\n                        return CATEGORY_COLORS[c] || '#cccccc';\n                    }),\n                    borderWidth: 1,\n                    // Custom properties used by the tooltip callback.\n                    _labels: categories,\n                    _facet: facet,\n                    _total: total,\n                });\n            });\n\n            if (datasets.length === 0) {\n                return;\n            }\n\n            // Destroy any previous chart instance for this container.\n            if (chartInstances[containerId]) {\n                chartInstances[containerId].destroy();\n            }\n\n            container.innerHTML = '';\n            const canvas = document.createElement('canvas');\n            canvas.width = CHART_SIZE;\n            canvas.height = CHART_SIZE;\n            container.appendChild(canvas);\n\n            chartInstances[containerId] = new Chartjs(canvas, {\n                type: 'doughnut',\n                data: {datasets: datasets},\n                options: {\n                    responsive: false,\n                    maintainAspectRatio: true,\n                    cutout: '20%',\n                    plugins: {\n                        legend: {display: false},\n                        tooltip: {\n                            callbacks: {\n                                title: function(items) {\n                                    if (items.length > 0) {\n                                        return items[0].dataset._facet || '';\n                                    }\n                                    return '';\n                                },\n                                label: function(context) {\n                                    var label = context.dataset._labels\n                                        ? context.dataset._labels[context.dataIndex]\n                                        : '';\n                                    var total = context.dataset._total || 0;\n                                    var pct = total > 0\n                                        ? Math.round(context.raw / total * 100)\n                                        : 0;\n                                    return label + ' ' + pct + '% (' + context.raw + ')';\n                                }\n                            }\n                        }\n                    },\n                    animation: false,\n                }\n            });\n        }\n\n        /**\n         * Re-render all currently visible charts.\n         */\n        function updateVisibleCharts() {\n            document.querySelectorAll('.rdb-chart-container').forEach(function(container) {\n                if (container.style.display !== 'none') {\n                    renderChart(container.id);\n                }\n            });\n        }\n\n        // Master chart toggle button â€“ toggles ALL charts at once.\n        var chartsVisible = false;\n        document.getElementById('rdb-chart-toggle').addEventListener('click', function() {\n            chartsVisible = !chartsVisible;\n            document.querySelectorAll('.rdb-chart-container').forEach(function(container) {\n                if (chartsVisible) {\n                    container.style.display = '';\n                    renderChart(container.id);\n                } else {\n                    container.style.display = 'none';\n                    if (chartInstances[container.id]) {\n                        chartInstances[container.id].destroy();\n                        delete chartInstances[container.id];\n                    }\n                    container.innerHTML = '';\n                }\n            });\n        });\n    });\n};"],"names":["window","console","log","table","DataTable","orderCellsTop","responsive","autoWidth","paging","layout","topStart","topEnd","bottomStart","buttons","extend","text","className","action","e","dt","s","rows","selected","every","rowIdx","tableLoop","rowLoop","node","this","cell","dataset","formattedEmail","navigator","clipboard","writeText","location","href","encodeURIComponent","deselect","columnDefs","orderable","render","select","targets","style","headerCheckbox","order","initComplete","api","columns","visible","document","querySelector","classList","add","updateFilterCounts","firstTime","each","i","filter","value","scope","name","replace","count","length","parentElement","filterCount","filterTotal","disabled","checked","toggle","querySelectorAll","forEach","container","display","renderChart","id","getElementById","addEventListener","dashboardTable","on","fn","dataTable","ext","search","push","settings","data","dataIndex","row","lastaccessed","textContent","label","find","groupmatch","groups","groupschecked","anygroupunchecked","dropdownlabel","group","lateassessments","earlyengagementFilters","earlyengagementFilter","earlyengagementid","itemMatch","items","itemsChecked","anyUnchecked","item","assessmentFilters","assessmentFilter","assessmentid","draw","currentTarget","target","FACET_ORDER","CATEGORY_COLORS","notdue","submitted","completed","overdue","passed","failed","extension","notcompleted","viewed","notviewed","none","chartInstances","containerId","visibleRows","nodes","toArray","facetCounts","f","cellCount","span","facet","category","filterCategory","undefined","Object","keys","extCount","datasets","counts","categories","values","map","c","total","reduce","a","b","backgroundColor","borderWidth","_labels","_facet","_total","destroy","innerHTML","canvas","createElement","width","height","appendChild","Chartjs","type","options","maintainAspectRatio","cutout","plugins","legend","tooltip","callbacks","title","context","Math","round","raw","animation","chartsVisible"],"mappings":"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"}