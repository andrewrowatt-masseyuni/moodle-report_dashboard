define("report_dashboard/dashboard",["exports","jquery","report_dashboard/dataTables","report_dashboard/dataTables.bootstrap4","report_dashboard/dataTables.select","report_dashboard/dataTables.buttons","report_dashboard/buttons.bootstrap4","report_dashboard/buttons.html5","core_user/repository","core/chartjs"],(function(_exports,_jquery,_dataTables,_dataTables2,_dataTables3,_dataTables4,_buttons,_buttons2,_repository,_chartjs){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module dashboard
   *
   * @module     report_dashboard/dashboard
   * @copyright  2025 Andrew Rowatt <A.J.Rowatt@massey.ac.nz>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_dataTables=_interopRequireDefault(_dataTables),_chartjs=_interopRequireDefault(_chartjs);_exports.init=()=>{(0,_jquery.default)((function(){window.console.log("Report dashboard initialising");var table=new _dataTables.default("#report_dashboard_dashboard",{orderCellsTop:!0,responsive:!1,autoWidth:!1,paging:!1,layout:{topStart:"info",topEnd:null,bottomStart:{buttons:[{extend:"excelHtml5",text:"Export to Excel"},{text:"Copy email addresses of selected students",className:"customButton customButtonCopyEmailAddress btn btn-secondary",action:function(e,dt){let s="";dt.rows({selected:!0}).every(((rowIdx,tableLoop,rowLoop)=>{const node=this.cell(rowIdx,2).node();s+=node.dataset.formattedEmail+";"})),navigator.clipboard.writeText(s)}},{text:"Create email to selected students...",className:"customButton customButtonCreateEmail btn btn-secondary",action:function(e,dt){var s="";dt.rows({selected:!0}).every(((rowIdx,tableLoop,rowLoop)=>{const node=this.cell(rowIdx,2).node();s+=node.dataset.formattedEmail+";"})),location.href="mailto:?bcc=".concat(encodeURIComponent(s))}},{text:"Clear selected rows",className:"customButton customButtonClearSelectedRows btn btn-secondary",action:function(e,dt){dt.rows({selected:!0}).deselect()}}]}},columnDefs:[{orderable:!1,render:_dataTables.default.render.select(),targets:0}],select:{style:"multi",headerCheckbox:"select-page"},order:[[1,"asc"]],initComplete:function(){this.api().columns([2]).visible(!1),document.querySelector(".dashboard_container").classList.add("dt-ready")}});function updateFilterCounts(firstTime){(0,_jquery.default)("[data-filter-count] > input").each((function(i,e){let filter=e.value,scope=e.name.replace("_filter",""),count=(0,_jquery.default)("td.".concat(scope,' [data-filter-category="').concat(filter,'"]')).length;e.parentElement.dataset.filterCount=count,firstTime&&(e.parentElement.dataset.filterTotal=count,e.disabled=!count,count||(e.checked=!1),e.parentElement.classList.toggle("text-muted",!count))})),document.querySelectorAll(".rdb-chart-container").forEach((function(container){"none"!==container.style.display&&renderChart(container.id)}))}document.getElementById("report_dashboard_fontsize").addEventListener("change",(function(){const dashboardTable=document.getElementById("report_dashboard_dashboard");dashboardTable.className=dashboardTable.className.replace(/\bsz-\d+\b/,"sz-"+this.value),(0,_repository.setUserPreference)("report_dashboard_fontsize",this.value)})),updateFilterCounts(!0),table.on("draw",(function(){updateFilterCounts(!1)})),_jquery.default.fn.dataTable.ext.search.push((function(settings,data,dataIndex){let row=(0,_jquery.default)(table.row(dataIndex).node()),lastaccessed=document.querySelector("input[name='lastaccessed']:checked");if(document.querySelector("#lastaccessed > button > span").textContent=lastaccessed.dataset.label,"all"!=lastaccessed.value&&0==row.find('td.tc_lastaccessed span[data-filter-category="'.concat(lastaccessed.value,'"]')).length)return!1;let groupmatch=!1,groups=document.querySelectorAll("input[name='groups']"),groupschecked=document.querySelectorAll("input[name='groups']:checked").length,anygroupunchecked=groups.length!=groupschecked,dropdownlabel="Unknown";for(const group of groups)if(group.checked&&(dropdownlabel=group.dataset.label,row.find('td.tc_groups span[data-filter-category="'.concat(group.value,'"]')).length>0)){groupmatch=!0;break}if(document.getElementById("group_select_all").disabled=!anygroupunchecked,document.getElementById("group_select_none").disabled=0==groupschecked,0==groupschecked?dropdownlabel="None":1==groupschecked||(dropdownlabel=anygroupunchecked?"Multiple Groups":"All"),document.querySelector("#group > button > span").textContent=dropdownlabel,!groupmatch)return!1;let lateassessments=document.querySelector("input[name='lateassessments']:checked");if(document.querySelector("#lateassessments > button > span").textContent=lateassessments.dataset.label,"all"!=lateassessments.value&&0==row.find('td.tc_lateassessments span[data-filter-category="'.concat(lateassessments.value,'"]')).length)return!1;let earlyengagementFilters=document.querySelectorAll(".earlyengagement_filter");for(const earlyengagementFilter of earlyengagementFilters){let id=earlyengagementFilter.dataset.earlyengagementid,itemMatch=!1,items=document.querySelectorAll("input[name='earlyengagement".concat(id,"_filter']")),itemsChecked=document.querySelectorAll("input[name='earlyengagement".concat(id,"_filter']:checked")).length,anyUnchecked=items.length!=itemsChecked,dropdownlabel="Unknown";for(const item of items)if(item.checked&&(dropdownlabel=item.dataset.label,row.find("td.tc_earlyengagement.earlyengagement".concat(id,' span[data-filter-category="').concat(item.value,'"]')).length>0)){itemMatch=!0;break}if(document.getElementById("earlyengagement".concat(id,"_select_all")).disabled=!anyUnchecked,document.getElementById("earlyengagement".concat(id,"_select_none")).disabled=0==itemsChecked,0==itemsChecked?dropdownlabel="None":1==itemsChecked||(dropdownlabel=anyUnchecked?"Multiple criteria":"All"),document.querySelector("#earlyengagement".concat(id," > button > span")).textContent=dropdownlabel,!itemMatch)return!1}let assessmentFilters=document.querySelectorAll(".assessment_filter");for(const assessmentFilter of assessmentFilters){let id=assessmentFilter.dataset.assessmentid,itemMatch=!1,items=document.querySelectorAll('label:not([data-filter-total="0"]) > input[name=\'assessment'.concat(id,"_filter']")),itemsChecked=document.querySelectorAll('label:not([data-filter-total="0"]) > input[name=\'assessment'.concat(id,"_filter']:checked")).length,anyUnchecked=items.length!=itemsChecked,dropdownlabel="Unknown";for(const item of items)if(item.checked&&(dropdownlabel=item.dataset.label,row.find("td.tc_assessment.assessment".concat(id,' span[data-filter-category="').concat(item.value,'"]')).length>0)){itemMatch=!0;break}if(document.getElementById("assessment".concat(id,"_select_all")).disabled=!anyUnchecked,document.getElementById("assessment".concat(id,"_select_none")).disabled=0==itemsChecked,0==itemsChecked?dropdownlabel="None":1==itemsChecked||(dropdownlabel=anyUnchecked?"Multiple criteria":"All"),document.querySelector("#assessment".concat(id," > button > span")).textContent=dropdownlabel,!itemMatch)return!1}return!0})),(0,_jquery.default)("#name_filter").on("input",(function(){table.columns(1).search(this.value).draw()})),(0,_jquery.default)("tr.filters .earlyengagement_filter .dropdown-menu").on("click",(e=>{let id=e.currentTarget.dataset.earlyengagementid;switch(e.target.id){case"earlyengagement".concat(id,"_select_all"):document.querySelectorAll("input[name='earlyengagement".concat(id,"_filter']")).forEach((item=>{item.disabled||(item.checked=!0)}));break;case"earlyengagement".concat(id,"_select_none"):document.querySelectorAll("input[name='earlyengagement".concat(id,"_filter']")).forEach((item=>{item.checked=!1}))}})),(0,_jquery.default)("tr.filters .assessment_filter .dropdown-menu").on("click",(e=>{let id=e.currentTarget.dataset.assessmentid;switch(e.target.id){case"assessment".concat(id,"_select_all"):document.querySelectorAll("input[name='assessment".concat(id,"_filter']")).forEach((item=>{item.disabled||(item.checked=!0)}));break;case"assessment".concat(id,"_select_none"):document.querySelectorAll("input[name='assessment".concat(id,"_filter']")).forEach((item=>{item.checked=!1}))}})),(0,_jquery.default)("tr.filters .dropdown-menu").on("click",(e=>{switch(e.target.id){case"group_select_all":document.querySelectorAll("input[name='groups']").forEach((group=>{group.disabled||(group.checked=!0)}));break;case"group_select_none":document.querySelectorAll("input[name='groups']").forEach((group=>{group.checked=!1}))}table.draw()}));const FACET_ORDER=["engagement","submission","extension"],CATEGORY_COLORS={notdue:"#e0e0e0",submitted:"#c5e0b4",completed:"#c5e0b4",overdue:"#fbe4d5",passed:"#c5e0b4",failed:"#fbe4d5",extension:"#d9edf7",notcompleted:"#d9edf7",viewed:"#c5e0b4",notviewed:"#bdd7ee",none:"#f5f5f5"},chartInstances={};function renderChart(containerId){const container=document.getElementById(containerId);if(!container||"none"===container.style.display)return;const scope=containerId.replace("chart_",""),visibleRows=table.rows({search:"applied"}).nodes().toArray();if(0===visibleRows.length)return;const facetCounts={};FACET_ORDER.forEach((function(f){facetCounts[f]={}}));var cellCount=0;if(visibleRows.forEach((function(row){const cell=row.querySelector("td."+scope);cell&&(cellCount++,cell.querySelectorAll("[data-facet]").forEach((function(span){const facet=span.dataset.facet,category=span.dataset.filterCategory;facet&&category&&void 0!==facetCounts[facet]&&(facetCounts[facet][category]=(facetCounts[facet][category]||0)+1)})))})),facetCounts.extension&&Object.keys(facetCounts.extension).length>0){const extCount=facetCounts.extension.extension||0;facetCounts.extension.none=cellCount-extCount}const datasets=[];if(FACET_ORDER.forEach((function(facet){const counts=facetCounts[facet],categories=Object.keys(counts);0!==categories.length&&datasets.push({data:categories.map((function(c){return counts[c]})),backgroundColor:categories.map((function(c){return CATEGORY_COLORS[c]||"#cccccc"})),borderWidth:1,_labels:categories,_facet:facet})})),0===datasets.length)return;chartInstances[containerId]&&chartInstances[containerId].destroy(),container.innerHTML="";const canvas=document.createElement("canvas");canvas.width=200,canvas.height=200,container.appendChild(canvas),chartInstances[containerId]=new _chartjs.default(canvas,{type:"doughnut",data:{datasets:datasets},options:{responsive:!1,maintainAspectRatio:!0,cutout:"20%",plugins:{legend:{display:!1},tooltip:{callbacks:{title:function(items){return items.length>0&&items[0].dataset._facet||""},label:function(context){return(context.dataset._labels?context.dataset._labels[context.dataIndex]:"")+": "+context.raw}}}},animation:!1}})}var chartsVisible=!1;document.getElementById("rdb-chart-toggle").addEventListener("click",(function(){chartsVisible=!chartsVisible,document.querySelectorAll(".rdb-chart-container").forEach((function(container){chartsVisible?(container.style.display="",renderChart(container.id)):(container.style.display="none",chartInstances[container.id]&&(chartInstances[container.id].destroy(),delete chartInstances[container.id]),container.innerHTML="")}))}))}))}}));

//# sourceMappingURL=dashboard.min.js.map